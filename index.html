<!DOCTYPE html>
<html>
<head>
  <title>Web Tool</title>
  <script src="js/vue.js"></script>
  <link rel="stylesheet" href="node_modules/xterm/css/xterm.css" />
  <script src="node_modules/xterm/lib/xterm.js"></script>
</head>
<body>
  <div id="app">
    <p>是否设置{{ message }}为新IP</p>
    <input v-model="message">
    <button v-on:click="setting">设置</button>
  </div>
  <div id="terminal"></div>
  <script>
    
    export default {
      name: 'Console',
      props: {
        terminal: {
          type: Object,
          default: {}
        }
      },
      data () {
        return {
          term: null,
          terminalSocket: null,
          message: '192.168.0.1'
        }
      },
      methods: {
        runRealTerminal () {
          console.log('webSocket is finished')
        },
        errorRealTerminal () {
          console.log('error')
        },
        closeRealTerminal () {
          console.log('close')
        },
        setting: function () {
          term.writeln('ping '+this.message)
        //this.message = this.message.split('').reverse().join('')
        }
      },
      mounted () {
        console.log('pid : ' + this.terminal.pid + ' is on ready')
        let terminalContainer = document.getElementById('terminal')
        this.term = new Terminal()
        this.term.open(terminalContainer)
        // open websocket
        this.terminalSocket = new WebSocket('ws://127.0.0.1:3000/terminals/')
        this.terminalSocket.onopen = this.runRealTerminal
        this.terminalSocket.onclose = this.closeRealTerminal
        this.terminalSocket.onerror = this.errorRealTerminal
        this.term.attach(this.terminalSocket)
        this.term._initialized = true
        console.log('mounted is going on')
      },
      beforeDestroy () {
        this.terminalSocket.close()
        this.term.destroy()
      }
    }
  </script>
</body>
</html>
